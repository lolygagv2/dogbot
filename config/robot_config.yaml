# TreatDispenser Robot Configuration
# Runtime configurable parameters

# Hardware Settings
hardware:
  motors:
    default_speed: 50
    max_speed: 100
    timeout_seconds: 10

  servos:
    pan_range: [10, 200]
    tilt_range: [60, 120]
    center_pan: 90
    center_tilt: 90

  camera:
    resolution: [640, 480]
    fps: 30
    auto_exposure: true

# AI Detection Settings
detection:
  # Available backends: hailo, opencv_yolo, mediapipe
  preferred_backend: "hailo"
  fallback_backend: "opencv_yolo"

  confidence_threshold: 0.5  # Lowered from 0.7 - dogs in clear view should be detected
  nms_threshold: 0.4

  # Classes to detect (COCO format)
  target_classes:
    - 16  # dog
    - 15  # cat (optional)

# Behavior Recognition
behavior:
  # Behaviors that trigger rewards
  reward_behaviors:
    sitting:
      duration_required: 2.0  # seconds
      confidence_required: 0.8
    lying:
      duration_required: 3.0
      confidence_required: 0.8
    staying:
      duration_required: 5.0
      confidence_required: 0.7
    spinning:
      duration_required: 1.0
      confidence_required: 0.9

  # Cooldown between treats (per dog)
  treat_cooldown_seconds: 30

  # Maximum treats per session
  max_treats_per_session: 10

# Audio Settings
audio:
  default_volume: 23
  sound_mappings:
    reward: "good_dog"
    startup: "door_scan"
    dog_detected: "hi_scan"
    no_dog: "busy_scan"

# LED Settings
leds:
  brightness: 0.3
  modes:
    idle: [30, 30, 30]          # dim white
    searching: [0, 255, 255]    # cyan
    dog_detected: [0, 255, 0]   # green
    treat_launch: [255, 255, 255] # bright white
    error: [255, 0, 0]          # red

# Mission System
missions:
  # Auto-start behavior
  auto_start: true

  # Operating modes
  modes:
    - "manual"      # Manual control only
    - "tracking"    # Track and reward automatically
    - "training"    # Interactive training mode
    - "patrol"      # Autonomous patrol mode

  default_mode: "tracking"

# Safety Settings
safety:
  emergency_stop_timeout: 0.5
  max_continuous_runtime: 3600  # 1 hour
  health_check_interval: 5.0

  # Auto-stop conditions
  auto_stop:
    low_battery: true
    hardware_fault: true
    no_dog_timeout: 300  # 5 minutes

# Logging
logging:
  level: "INFO"
  file_path: "/var/log/treatdispenser.log"
  max_file_size: "10MB"
  backup_count: 5

  # What to log
  log_detections: true
  log_behaviors: true
  log_rewards: true
  log_hardware_status: true

  # Bark Detection Configuration
bark_detection:
  enabled: true  # Now using USB audio with conference microphone
  model_path: "/home/morgan/dogbot/ai/models/dog_bark_classifier.tflite"
  emotion_mapping_path: "/home/morgan/dogbot/ai/models/emotion_mapping.json"

  # Audio settings (tuned for USB lavalier mic - adjust gain with better mic)
  sample_rate: 22050  # Model expects this (DO NOT CHANGE)
  duration: 3.0  # Model trained on 3-second clips (DO NOT CHANGE)
  n_mels: 128
  audio_gain: 30.0  # High amplification needed for quiet lavalier mic

  # Detection settings
  confidence_threshold: 0.43  # Minimum confidence for valid bark (lowered for testing)
  reward_emotions:  # Emotions that trigger treat dispensing
    - alert
    - attention

  # Processing
  check_interval: 0.5  # Seconds between bark checks
  cooldown_period: 5.0  # Seconds to wait between treats

# WebRTC Streaming Configuration
webrtc:
  enabled: true

  # ICE servers for NAT traversal
  stun_servers:
    - "stun:stun.l.google.com:19302"
    - "stun:stun1.l.google.com:19302"

  # TURN servers (add credentials for cloud relay)
  turn_servers: []
    # - urls: "turn:your-turn-server.com:3478"
    #   username: "wimz"
    #   credential: "your-secret"

  # Video settings
  video:
    fps: 15              # Target FPS (15 recommended for Pi 5)
    bitrate: 1500000     # 1.5 Mbps max bitrate
    codec: "VP8"         # VP8 or H264
    enable_ai_overlay: true  # Draw detection boxes on stream

  # Connection limits
  max_connections: 2     # Max concurrent WebRTC clients

# Cloud Relay Configuration
cloud:
  enabled: true  # Enable cloud relay connection (requires DEVICE_ID and DEVICE_SECRET env vars)
  relay_url: "wss://api.wimzai.com/ws/device"
  # Credentials from environment variables:
  # DEVICE_ID: Device identifier from cloud dashboard
  # DEVICE_SECRET: Device secret for HMAC authentication
  reconnect_delay: 5      # Seconds between reconnection attempts
  heartbeat_interval: 30  # Seconds between heartbeat pings